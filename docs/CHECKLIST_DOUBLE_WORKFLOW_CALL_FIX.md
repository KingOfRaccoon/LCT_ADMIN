# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞

**–î–∞—Ç–∞:** 1 –æ–∫—Ç—è–±—Ä—è 2025  
**Dev Server:** http://localhost:5174  
**–ü—Ä–æ–≤–µ—Ä—è—é—â–∏–π:** _____________  

---

## üìã Pre-Check

- [ ] Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`npm run dev`)
- [ ] –ü–æ—Ä—Ç 5174 –æ—Ç–∫—Ä—ã—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] DevTools –æ—Ç–∫—Ä—ã—Ç—ã (F12 –∏–ª–∏ Cmd+Option+I)
- [ ] Network tab –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ `client/workflow`
- [ ] Console tab –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –ª–æ–≥–æ–≤

---

## üß™ Test 1: Sandbox - ClientWorkflowRunner

### –®–∞–≥–∏:
1. [ ] –û—á–∏—Å—Ç–∏—Ç–µ Network –∏ Console
2. [ ] –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:5174/sandbox`
3. [ ] –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**Network:**
- [ ] **–†–æ–≤–Ω–æ 1** –∑–∞–ø—Ä–æ—Å `POST /client/workflow`
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤

**Console:**
- [ ] `üöÄ [ClientWorkflowRunner] Auto-starting workflow: <id>`
- [ ] `‚úÖ [ClientWorkflowRunner] Workflow started successfully`
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `‚ö†Ô∏è [useClientWorkflow] startWorkflow ignored: already loading`

**UI:**
- [ ] –≠–∫—Ä–∞–Ω –æ—Ç—Ä–∏—Å–æ–≤–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- [ ] History –ø—É—Å—Ç –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: _______
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: _______ ms
- Errors: _______ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)

---

## üß™ Test 2: Preview - PreviewPageNew

### –®–∞–≥–∏:
1. [ ] –û—á–∏—Å—Ç–∏—Ç–µ Network –∏ Console
2. [ ] –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:5174/preview?workflow_id=68dd68fe8341ae5cb6c60024`
3. [ ] –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**Network:**
- [ ] **–†–æ–≤–Ω–æ 1** –∑–∞–ø—Ä–æ—Å `POST /client/workflow`
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤

**Console:**
- [ ] `üöÄ [PreviewPage] Starting workflow: <id>`
- [ ] `‚úÖ [PreviewPage] Workflow started successfully`
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `‚ö†Ô∏è [useClientWorkflow] startWorkflow ignored: already loading`

**UI:**
- [ ] –≠–∫—Ä–∞–Ω –æ—Ç—Ä–∏—Å–æ–≤–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ö–Ω–æ–ø–∫–∏ Back/Refresh/Reset –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: _______
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: _______ ms
- Errors: _______ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)

---

## üß™ Test 3: React Strict Mode (–¥–≤–æ–π–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ StrictMode:

1. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ `src/main.jsx`
2. [ ] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å `<React.StrictMode>`

```javascript
<React.StrictMode>
  <App />
</React.StrictMode>
```

### –®–∞–≥–∏:
1. [ ] Hard refresh (Cmd+Shift+R –∏–ª–∏ Ctrl+Shift+R)
2. [ ] –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ Network –∏ Console

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è **–¥–≤–∞–∂–¥—ã** –≤ Console (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- [ ] API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑** (–∑–∞—â–∏—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞)

**Console (–≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã):**
```
–í–∞—Ä–∏–∞–Ω—Ç 1 (–∏–¥–µ–∞–ª—å–Ω—ã–π):
üöÄ [Component] Auto-starting workflow: xxx
‚úÖ [Component] Workflow started successfully

–í–∞—Ä–∏–∞–Ω—Ç 2 (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π):
üöÄ [Component] Auto-starting workflow: xxx
‚ö†Ô∏è [useClientWorkflow] startWorkflow ignored: already loading
‚úÖ [Component] Workflow started successfully
```

- [ ] –õ—é–±–æ–π –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏–µ–º–ª–µ–º
- [ ] –ì–ª–∞–≤–Ω–æ–µ: **1 POST –∑–∞–ø—Ä–æ—Å** –≤ Network

---

## üß™ Test 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ workflow_id

### –®–∞–≥–∏:
1. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ Preview —Å `workflow_id=111111111111111111111111`
2. [ ] –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1 –∑–∞–ø—Ä–æ—Å)
3. [ ] –ò–∑–º–µ–Ω–∏—Ç–µ URL –Ω–∞ `workflow_id=222222222222222222222222`
4. [ ] –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ workflow

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**Network:**
- [ ] **2 –∑–∞–ø—Ä–æ—Å–∞** (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π workflow_id)
- [ ] –ü–µ—Ä–≤—ã–π: `workflow_id=111...`
- [ ] –í—Ç–æ—Ä–æ–π: `workflow_id=222...`

**Console:**
- [ ] –î–≤–∞ –ª–æ–≥–∞ `üöÄ Auto-starting workflow`
- [ ] –î–≤–∞ –ª–æ–≥–∞ `‚úÖ Workflow started successfully`

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ó–∞–ø—Ä–æ—Å #1 workflow_id: _______
- –ó–∞–ø—Ä–æ—Å #2 workflow_id: _______
- –û–±–∞ –∑–∞–ø—Ä–æ—Å–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã: [ ] –î–∞

---

## üß™ Test 5: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã (Manual)

### –û—Ç–∫—Ä—ã–≤–∞–µ–º Console –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º:

```javascript
// –ü–æ–ø—ã—Ç–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
const testDoubleCall = async () => {
  const workflow = window.__useClientWorkflow; // –µ—Å–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
  
  Promise.all([
    workflow.startWorkflow('test1', {}),
    workflow.startWorkflow('test2', {})
  ]);
};

testDoubleCall();
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**Console:**
- [ ] `‚ö†Ô∏è [useClientWorkflow] startWorkflow ignored: already loading`

**Network:**
- [ ] –¢–æ–ª—å–∫–æ 1 –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è

---

## üêõ Test 6: Error Handling

### –®–∞–≥–∏:
1. [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backend (–µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π) –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. [ ] –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/sandbox`
3. [ ] –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**UI:**
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è error banner
- [ ] –°–æ–æ–±—â–µ–Ω–∏–µ: "Client Workflow API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
- [ ] –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**Console:**
- [ ] `‚ùå [ClientWorkflowRunner] Failed to auto-start: <error>`
- [ ] `isStartingRef` —Å–±—Ä–æ—à–µ–Ω –≤ `false` (–ø—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ–∑–º–æ–∂–µ–Ω)
- [ ] `startedWorkflowIdRef` —Å–±—Ä–æ—à–µ–Ω –≤ `null`

---

## üîç Test 7: localStorage Session

### –®–∞–≥–∏:
1. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Local Storage
2. [ ] –ù–∞–π–¥–∏—Ç–µ –∫–ª—é—á `bdui_client_session_id`
3. [ ] –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ: _______________________

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
1. [ ] –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `bdui_client_session_id` **–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è**
3. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É ‚Üí —Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω
4. [ ] `bdui_client_session_id` **—Ç–æ—Ç –∂–µ —Å–∞–º—ã–π**

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- [ ] Session ID —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏
- [ ] Session ID –æ–¥–∏–Ω –¥–ª—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
- [ ] –§–æ—Ä–º–∞—Ç: UUID v4 (–Ω–∞–ø—Ä–∏–º–µ—Ä, `550e8400-e29b-41d4-a716-446655440000`)

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

| Test | –û–∂–∏–¥–∞–µ—Ç—Å—è | –†–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|------|-----------|-----------|--------|
| Test 1: Sandbox | 1 POST –∑–∞–ø—Ä–æ—Å | _______ | [ ] ‚úÖ / [ ] ‚ùå |
| Test 2: Preview | 1 POST –∑–∞–ø—Ä–æ—Å | _______ | [ ] ‚úÖ / [ ] ‚ùå |
| Test 3: Strict Mode | 1 POST –∑–∞–ø—Ä–æ—Å | _______ | [ ] ‚úÖ / [ ] ‚ùå |
| Test 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ID | 2 POST –∑–∞–ø—Ä–æ—Å–∞ | _______ | [ ] ‚úÖ / [ ] ‚ùå |
| Test 5: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã | 1 POST –∑–∞–ø—Ä–æ—Å | _______ | [ ] ‚úÖ / [ ] ‚ùå |
| Test 6: Error Handling | Error banner | _______ | [ ] ‚úÖ / [ ] ‚ùå |
| Test 7: localStorage | Persistent ID | _______ | [ ] ‚úÖ / [ ] ‚ùå |

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

### –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã?
- [ ] **–î–∞** ‚Äî –ì–æ—Ç–æ–≤–æ –∫ production
- [ ] **–ù–µ—Ç** ‚Äî –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
```
1. _________________________________________
2. _________________________________________
3. _________________________________________
```

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
```
_________________________________________
_________________________________________
_________________________________________
```

---

## üöÄ Sign-off

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –ò–º—è: _____________
- –î–∞—Ç–∞: _____________
- –ü–æ–¥–ø–∏—Å—å: _____________

**–°—Ç–∞—Ç—É—Å:** [ ] ‚úÖ APPROVED  [ ] ‚ùå REJECTED  [ ] üîÑ NEEDS REVISION

---

## üìö –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Fix Documentation](./fixes/double-client-workflow-call-fix.md)
- [Test Plan](./tests/test-double-workflow-call.md)
- [Visualization](./diagrams/double-workflow-call-fix-visualization.md)
- [Summary](./DOUBLE_WORKFLOW_CALL_FIX_SUMMARY.md)
