{
  "id": "avito-cart-demo",
  "name": "Авито — Корзина",
  "description": "Профессиональный сценарий корзины с загрузкой товаров из API",
  "slug": "avito-cart",
  "variableSchemas": {
    "cart_response": {
      "type": "object",
      "schema": {
        "id": "number",
        "user_id": "number",
        "advertisements": "array"
      }
    },
    "store": {
      "type": "object",
      "schema": {
        "id": "number",
        "name": "string",
        "rating": "number"
      }
    },
    "ui": {
      "type": "object",
      "schema": {
        "ready": "boolean",
        "notifications": "object"
      }
    },
    "state": {
      "type": "object",
      "schema": {
        "empty": "boolean",
        "loading": "boolean"
      }
    }
  },
  "initialContext": {
    "cart_response": {
      "id": 3,
      "user_id": 14,
      "advertisements": []
    },
    "store": {
      "id": 14,
      "name": "Екатерина Батюшкова",
      "rating": 5.0
    },
    "selected_advertisement_id": 8,
    "add_to_cart_response": null,
    "ui": {
      "ready": false,
      "notifications": {
        "type": null,
        "message": null,
        "actionLabel": null,
        "actionEvent": null
      }
    },
    "state": {
      "empty": true,
      "loading": false
    }
  },
  "nodes": [
    {
      "id": "fetch-cart-items",
      "label": "Загрузка товаров корзины",
      "type": "integration",
      "state_type": "integration",
      "start": true,
      "description": "Загружает корзину с товарами пользователя",
      "expressions": [
        {
          "variable": "cart_response",
          "url": "https://sandkittens.me/backservices/api/carts/3/with-advertisements",
          "params": {},
          "method": "get",
          "metadata": {
            "description": "Получает корзину с ID 3 и все товары в ней",
            "category": "data",
            "tags": ["integration", "api", "cart", "advertisements"]
          }
        }
      ],
      "transitions": [
        {
          "variable": "cart_response",
          "case": null,
          "state_id": "cart-main"
        }
      ],
      "edges": []
    },
    {
      "id": "cart-main",
      "label": "Корзина",
      "type": "screen",
      "screenId": "screen-cart-main",
      "start": false,
      "edges": [
        {
          "id": "edge-add-to-cart",
          "label": "Добавить товар",
          "event": "addToCart",
          "keepInputs": true,
          "summary": "Добавление товара в корзину",
          "target": "add-to-cart-integration",
          "contextPatch": {}
        },
        {
          "id": "edge-checkout",
          "label": "Оформить заказ",
          "event": "checkout",
          "keepInputs": true,
          "summary": "Переход к оформлению заказа",
          "target": "checkout-screen",
          "contextPatch": {}
        }
      ]
    },
    {
      "id": "add-to-cart-integration",
      "label": "Добавление товара в корзину",
      "type": "integration",
      "state_type": "integration",
      "start": false,
      "description": "POST-запрос для добавления товара в корзину",
      "expressions": [
        {
          "variable": "add_to_cart_response",
          "url": "https://sandkittens.me/backservices/api/carts/add-advertisement",
          "params": {},
          "method": "post",
          "body": {
            "cart_id": 3,
            "advertisement_id": 10
          },
          "metadata": {
            "description": "Добавляет товар в корзину пользователя",
            "category": "data",
            "tags": ["integration", "api", "cart", "post"]
          }
        }
      ],
      "transitions": [
        {
          "variable": "add_to_cart_response",
          "case": null,
          "state_id": "fetch-cart-items"
        }
      ],
      "edges": []
    },
    {
      "id": "checkout-screen",
      "label": "Оформление заказа",
      "type": "screen",
      "screenId": "screen-checkout",
      "edges": []
    }
  ],
  "screens": {
    "screen-cart-main": {
      "id": "screen-cart-main",
      "type": "Screen",
      "name": "Корзина",
      "style": {
        "display": "flex",
        "flexDirection": "column",
        "minHeight": "720px",
        "backgroundColor": "#ffffff",
        "borderRadius": "12px",
        "padding": "0px"
      },
      "sections": {
        "header": {
          "id": "section-cart-header",
          "type": "Section",
          "properties": {
            "slot": "header",
            "padding": 16,
            "spacing": 12,
            "background": "#ffffff"
          },
          "style": {
            "borderBottom": "1px solid #E5E5E5"
          },
          "children": [
            {
              "id": "text-cart-title",
              "type": "text",
              "properties": {
                "content": "Корзина",
                "variant": "heading"
              },
              "style": {
                "fontSize": "24px",
                "fontWeight": 700,
                "color": "#2F3034"
              }
            },
            {
              "id": "row-cart-actions",
              "type": "row",
              "properties": {
                "spacing": 12,
                "alignItems": "center",
                "justifyContent": "space-between"
              },
              "children": [
                {
                  "id": "text-store-name",
                  "type": "text",
                  "properties": {
                    "content": {
                      "reference": "${store.name}",
                      "value": "Магазин"
                    },
                    "variant": "body"
                  },
                  "style": {
                    "fontSize": "15px",
                    "color": "#000000",
                    "fontWeight": 400
                  }
                }
              ]
            }
          ]
        },
        "body": {
          "id": "section-cart-body",
          "type": "Section",
          "properties": {
            "slot": "body",
            "padding": 16,
            "spacing": 16,
            "alignItems": "stretch"
          },
          "style": {
            "flex": "1 1 auto",
            "overflowY": "auto"
          },
          "children": [
            {
              "id": "list-cart-items",
              "type": "list",
              "properties": {
                "dataSource": {
                  "reference": "${cart_response.advertisements}",
                  "value": []
                },
                "itemAlias": "product"
              },
              "style": {
                "display": "flex",
                "flexDirection": "column",
                "gap": "12px"
              },
              "children": [
                {
                  "id": "row-cart-item-{{itemIndex}}",
                  "type": "row",
                  "properties": {
                    "spacing": 12,
                    "alignItems": "flex-start",
                    "padding": 12,
                    "background": "#ffffff"
                  },
                  "style": {
                    "borderRadius": "12px",
                    "border": "1px solid #E5E5E5"
                  },
                  "children": [
                    {
                      "id": "column-item-details-{{itemIndex}}",
                      "type": "column",
                      "properties": {
                        "spacing": 8,
                        "flex": 1
                      },
                      "children": [
                        {
                          "id": "text-item-title-{{itemIndex}}",
                          "type": "text",
                          "properties": {
                            "content": {
                              "reference": "${product.name}",
                              "value": "Название товара"
                            },
                            "variant": "body"
                          },
                          "style": {
                            "fontSize": "15px",
                            "fontWeight": 600,
                            "color": "#000000"
                          }
                        },
                        {
                          "id": "text-item-description-{{itemIndex}}",
                          "type": "text",
                          "properties": {
                            "content": {
                              "reference": "${product.description}",
                              "value": "Описание товара"
                            },
                            "variant": "caption"
                          },
                          "style": {
                            "fontSize": "13px",
                            "fontWeight": 400,
                            "color": "#8E8E93"
                          }
                        },
                        {
                          "id": "text-item-owner-{{itemIndex}}",
                          "type": "text",
                          "properties": {
                            "content": {
                              "reference": "${product.owner_name}",
                              "value": "Продавец"
                            },
                            "variant": "caption"
                          },
                          "style": {
                            "fontSize": "12px",
                            "fontWeight": 400,
                            "color": "#8E8E93"
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "id": "button-add-to-cart",
              "type": "button",
              "properties": {
                "text": "Добавить товар в корзину",
                "variant": "secondary",
                "event": "addToCart",
                "eventParams": {
                  "advertisement_id": 8
                }
              },
              "style": {
                "marginTop": "16px",
                "padding": "12px 24px",
                "borderRadius": "12px",
                "backgroundColor": "#F0F0F0",
                "fontSize": "15px",
                "fontWeight": 600,
                "color": "#0A74F0",
                "border": "1px solid #E5E5E5",
                "cursor": "pointer"
              }
            }
          ]
        },
        "footer": {
          "id": "section-cart-footer",
          "type": "Section",
          "properties": {
            "slot": "footer",
            "padding": 16,
            "spacing": 0,
            "background": "#ffffff"
          },
          "style": {
            "borderTop": "1px solid #E5E5E5",
            "boxShadow": "0 -2px 8px rgba(0, 0, 0, 0.08)"
          },
          "children": [
            {
              "id": "button-checkout",
              "type": "button",
              "properties": {
                "text": "Перейти к оформлению",
                "variant": "primary",
                "event": "checkout"
              },
              "style": {
                "width": "100%",
                "padding": "16px",
                "borderRadius": "12px",
                "backgroundColor": "#0A74F0",
                "fontSize": "16px",
                "fontWeight": 600,
                "color": "#ffffff"
              }
            }
          ]
        }
      }
    },
    "screen-checkout": {
      "id": "screen-checkout",
      "type": "Screen",
      "name": "Оформление",
      "style": {
        "display": "flex",
        "flexDirection": "column",
        "minHeight": "720px",
        "backgroundColor": "#ffffff",
        "borderRadius": "12px",
        "padding": "0px"
      },
      "sections": {
        "body": {
          "id": "section-checkout-body",
          "type": "Section",
          "properties": {
            "slot": "body",
            "padding": 32,
            "spacing": 16,
            "alignItems": "stretch"
          },
          "style": {
            "flex": "1 1 auto"
          },
          "children": [
            {
              "id": "text-checkout-title",
              "type": "text",
              "properties": {
                "content": "Оформление заказа",
                "variant": "heading"
              },
              "style": {
                "fontSize": "24px",
                "fontWeight": 700,
                "color": "#2F3034"
              }
            },
            {
              "id": "text-checkout-placeholder",
              "type": "text",
              "properties": {
                "content": "Форма оформления появится здесь",
                "variant": "body"
              },
              "style": {
                "fontSize": "15px",
                "color": "#8E8E93"
              }
            }
          ]
        }
      }
    }
  }
}
