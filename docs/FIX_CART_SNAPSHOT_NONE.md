# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤" –≤ –∫–æ—Ä–∑–∏–Ω–µ

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —ç–∫—Ä–∞–Ω–∞ `CartOverviewScreen` –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å "–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤", —Ö–æ—Ç—è API –≤–æ–∑–≤—Ä–∞—â–∞–ª –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö –≤ –∫–æ—Ä–∑–∏–Ω–µ.

**–ü—Ä–∏—á–∏–Ω–∞:** API –≤–æ–∑–≤—Ä–∞—â–∞–ª `cart_snapshot: "None"` (—Å—Ç—Ä–æ–∫–∞), –∞ —Å—Ö–µ–º–∞ —ç–∫—Ä–∞–Ω–∞ –ø—ã—Ç–∞–ª–∞—Å—å –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ `${cart_snapshot.stores}`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ `undefined` ‚Üí –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ ‚Üí "–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤".

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∏–Ω–¥–∏–Ω–≥–æ–≤
**–§–∞–π–ª:** `src/pages/Sandbox/utils/bindings.js`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é `getContextValue()`:
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ "–ø—É—Å—Ç—ã—à–∫–∏" (`"None"`, `"null"`, `"undefined"`) —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ `undefined`
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–ø—ã—Ç–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–≤–æ–π—Å—Ç–≤–∞–º –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫/—á–∏—Å–µ–ª)

```javascript
// –ó–∞—â–∏—Ç–∞ –æ—Ç null, undefined –∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–∞–≥–ª—É—à–µ–∫ —Ç–∏–ø–∞ "None"
if (acc === undefined || acc === null || acc === 'None' || acc === 'null' || acc === 'undefined') {
  return undefined;
}

// –ï—Å–ª–∏ acc ‚Äî –ø—Ä–∏–º–∏—Ç–∏–≤ (—Å—Ç—Ä–æ–∫–∞/—á–∏—Å–ª–æ/boolean), –Ω–æ –Ω–µ –æ–±—ä–µ–∫—Ç/–º–∞—Å—Å–∏–≤, –¥–∞–ª—å—à–µ –∏–¥—Ç–∏ –Ω–µ–ª—å–∑—è
if (typeof acc !== 'object') {
  return undefined;
}
```

### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—Ç API
**–§–∞–π–ª:** `src/services/clientWorkflowApi.js`

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalizeContext()`, –∫–æ—Ç–æ—Ä–∞—è:
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `"None"`, `"null"`, `"undefined"` ‚Üí `null`
- –ü–∞—Ä—Å–∏—Ç JSON-—Å—Ç—Ä–æ–∫–∏ (—Å –æ–¥–∏–Ω–∞—Ä–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏ –æ—Ç Python) –≤ –æ–±—ä–µ–∫—Ç—ã/–º–∞—Å—Å–∏–≤—ã

```javascript
function normalizeContext(context) {
  const normalized = {};
  
  for (const [key, value] of Object.entries(context)) {
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø—É—Å—Ç—ã—à–∫–∏ –≤ null
    if (value === 'None' || value === 'null' || value === 'undefined') {
      normalized[key] = null;
      continue;
    }

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è (Python ‚Üí "True"/"False")
    if (value === 'False' || value === 'false') {
      normalized[key] = false;
      continue;
    }
    if (value === 'True' || value === 'true') {
      normalized[key] = true;
      continue;
    }

    // –ü–∞—Ä—Å–∏–º JSON-—Å—Ç—Ä–æ–∫–∏ (Python –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏)
    if (typeof value === 'string' && (value.startsWith('[') || value.startsWith('{'))) {
      try {
        const jsonString = value.replace(/'/g, '"');
        normalized[key] = JSON.parse(jsonString);
        continue;
      } catch {
        // –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
      }
    }

    normalized[key] = value;
  }

  return normalized;
}
```

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–∞—Ö API:
- `startClientWorkflow()`
- `sendClientAction()`
- `getCurrentWorkflowState()`
- `resetClientWorkflow()`

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
{
  "cart_snapshot": "None",  // –∏–ª–∏ "False"
  "init_done": "True",
  "stores_catalog": "[{'id': 201, 'name': 'Pear Store'}]"
}
```
‚Üí `cart_snapshot.stores` = `undefined` ‚Üí "–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤"

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
{
  "cart_snapshot": null,  // "None" ‚Üí null
  "init_done": true,      // "True" ‚Üí true
  "stores_catalog": [{"id": 201, "name": "Pear Store"}]  // JSON —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω
}
```
‚Üí –ë–∏–Ω–¥–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback-–∑–Ω–∞—á–µ–Ω–∏–µ ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test-context-normalization.js`:

```bash
node test-context-normalization.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ cart_snapshot: false (–±—É–ª–µ–≤)
‚úÖ cart_snapshot_error_flag: false
‚úÖ init_done: true
‚úÖ recommended_products: array
‚úÖ stores_catalog: array
‚úÖ selected_items: array (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ)
‚úÖ checkout_error: object (–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ)
```

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/pages/Sandbox/utils/bindings.js` ‚Äî –∑–∞—â–∏—Ç–∞ –±–∏–Ω–¥–∏–Ω–≥–æ–≤
- `src/services/clientWorkflowApi.js` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è API
- `test-context-normalization.js` ‚Äî —Ç–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

## üîÆ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –±—ç–∫–µ–Ω–¥–∞:** –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ JSON-–æ–±—ä–µ–∫—Ç—ã –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
2. **–î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:** –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ `cart_snapshot === null` (–ø—É—Å—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞ vs –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏)
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `"None"` –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –ø–æ–ª–µ–π

---
**–î–∞—Ç–∞:** 2 –æ–∫—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
