# üéØ –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –í—ã–Ω–æ—Å –ª–æ–≥–∏–∫–∏ –≤ JSON

**–î–∞—Ç–∞:** 30 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥.  
**–¶–µ–ª—å:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–∞–∫—Å–∏–º—É–º –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π](#–æ–±–∑–æ—Ä-–∏–∑–º–µ–Ω–µ–Ω–∏–π)
2. [–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä](#–¥–µ—Ç–∞–ª—å–Ω—ã–π-—Ä–∞–∑–±–æ—Ä)
3. [–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞](#—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üéØ –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ß—Ç–æ –±—ã–ª–æ –≤—ã–Ω–µ—Å–µ–Ω–æ –∏–∑ –∫–æ–¥–∞ –≤ JSON:

1. **EVENT_RULES** ‚Äî –º–∞–ø–ø–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –Ω–∞ —Ä—ë–±—Ä–∞ –≥—Ä–∞—Ñ–∞
2. **buildDynamicPatch** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
3. **BUTTON_EVENT_INJECTIONS** ‚Äî –∏–Ω—ä–µ–∫—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | 869 | 788 | **-81 —Å—Ç—Ä–æ–∫–∞ (-9.3%)** |
| –•–∞—Ä–¥–∫–æ–¥-–∫–æ–Ω—Å—Ç–∞–Ω—Ç | 2 | 0 | **-100%** |
| –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å | ~60% | ~95% | **+35%** |
| –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | **+‚àû** |

---

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä

### 1. EVENT_RULES ‚Üí –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä—ë–±—Ä–∞

#### ‚ùå –ë—ã–ª–æ (—Ö–∞—Ä–¥–∫–æ–¥ –≤ server.js):

```javascript
const EVENT_RULES = PRESET_NAME === 'ecommerceDashboard' ? {
  checkemail: { sourceNode: 'email-entry', edgeId: 'edge-email-submit', keepInputs: true },
  retryfromsuccess: { sourceNode: 'email-valid', edgeId: 'edge-valid-retry', keepInputs: false },
  retryfromerror: { sourceNode: 'email-invalid', edgeId: 'edge-invalid-retry', keepInputs: false }
} : {
  loadcomplete: { sourceNode: 'loading', edgeId: 'edge-load-complete', keepInputs: false },
  incrementitem: { sourceNode: 'cart-main', edgeId: 'edge-increment-item', keepInputs: true },
  decrementitem: { sourceNode: 'cart-main', edgeId: 'edge-decrement-item', keepInputs: true },
  // ... –µ—â—ë 7 —Å–æ–±—ã—Ç–∏–π
};
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –•–∞—Ä–¥–∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ñ—ë—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –Ω–∞–∑–≤–∞–Ω–∏—è–º –ø—Ä–µ—Å–µ—Ç–æ–≤

#### ‚úÖ –°—Ç–∞–ª–æ (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –≤ JSON):

**avitoDemo.json:**
```json
{
  "id": "cart-main",
  "edges": [
    {
      "id": "edge-increment-item",
      "label": "–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
      "event": "incrementItem",
      "keepInputs": true,
      "target": "action-increment",
      "contextPatch": {}
    },
    {
      "id": "edge-decrement-item",
      "label": "–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
      "event": "decrementItem",
      "keepInputs": true,
      "target": "action-decrement",
      "contextPatch": {}
    }
  ]
}
```

**ecommerceDashboard.json:**
```json
{
  "id": "email-entry",
  "edges": [
    {
      "id": "edge-email-submit",
      "event": "checkEmail",
      "keepInputs": true,
      "target": "validate-email"
    }
  ]
}
```

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤ server.js:**
```javascript
const handleEvent = async (eventName, query) => {
  const normalized = eventName.trim().toLowerCase();
  
  // –ò—â–µ–º —Ä–µ–±—Ä–æ —Å —Å–æ–±—ã—Ç–∏–µ–º –≤ EDGE_REGISTRY
  let matchingEdge = null;
  for (const [edgeId, edge] of EDGE_REGISTRY.entries()) {
    if (edge.event && edge.event.toLowerCase() === normalized) {
      matchingEdge = edge;
      break;
    }
  }
  
  if (!matchingEdge) {
    throw new HttpError(404, `Unknown event '${eventName}'`);
  }
  
  const keepInputs = matchingEdge.keepInputs ?? true;
  // ... –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
};
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–æ–±—ã—Ç–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ JSON —Ä—è–¥–æ–º —Å —É–∑–ª–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
- ‚úÖ –°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–∞—è—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –°–µ—Ä–≤–µ—Ä —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω –¥–ª—è –ª—é–±—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤

---

### 2. buildDynamicPatch ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –ª–æ–≥–∏–∫–∏

#### ‚ùå –ë—ã–ª–æ (—Ö–∞—Ä–¥–∫–æ–¥ –≤ server.js):

```javascript
const buildDynamicPatch = (event, inputs, context) => {
  // –î–ª—è ecommerceDashboard –∏–Ω—ä–µ–∫—Ü–∏—è email
  if (PRESET_NAME === 'ecommerceDashboard' && typeof inputs.email === 'string') {
    return { 'inputs.email': inputs.email.trim() };
  }
  
  // –î–ª—è avitoDemo: –ª–æ–≥–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã (—É–∂–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ action-—É–∑–ª—ã)
  
  return {};
};

// –í—ã–∑–æ–≤ –≤ handleEvent:
const dynamicPatch = buildDynamicPatch(normalized, inputs, contextWithParams);
const contextWithInputs = applyPatchToContext(contextWithParams, dynamicPatch);
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (inputs —É–∂–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ buildApiContext)
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

#### ‚úÖ –°—Ç–∞–ª–æ (–ø—Ä—è–º–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è):

```javascript
const handleEvent = async (eventName, query) => {
  // ...
  
  const baseContext = await buildBaseContextWithPrefetch();
  
  const contextWithParams = {
    ...baseContext,
    _queryParams: formValues
  };
  
  // –î–ª—è ecommerceDashboard –¥–æ–±–∞–≤–ª—è–µ–º inputs –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
  if (PRESET_NAME === 'ecommerceDashboard') {
    contextWithParams.inputs = { ...DEFAULT_INPUTS, ...inputs };
  }

  const edgeResult = runEdgeSequence(matchingEdge.id, sourceNodeId, contextWithParams);
  // ...
};
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–±—Ä–∞–ª–∏ 14 —Å—Ç—Ä–æ–∫ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –ü—Ä—è–º–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è inputs –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ –õ–æ–≥–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã —É–∂–µ –≤ action-—É–∑–ª–∞—Ö (modify-cart-item)
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏

---

### 3. BUTTON_EVENT_INJECTIONS ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –ª–æ–≥–∏–∫–∏

#### ‚ùå –ë—ã–ª–æ (68 —Å—Ç—Ä–æ–∫ —Ö–∞—Ä–¥–∫–æ–¥–∞):

```javascript
const BUTTON_EVENT_INJECTIONS = {};

const injectButtonEvents = (screenId, screen) => {
  const injections = BUTTON_EVENT_INJECTIONS[screenId];
  if (!injections || !screen || typeof screen !== 'object') {
    return;
  }

  const componentMap = new Map();
  
  const registerComponent = (component) => {
    // ... 30+ —Å—Ç—Ä–æ–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –æ–±—Ö–æ–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  };
  
  // ... 35+ —Å—Ç—Ä–æ–∫ –ø–æ–∏—Å–∫–∞ –∏ –∏–Ω—ä–µ–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
};

const getScreenPayload = (screenId) => {
  const screen = SCREEN_REGISTRY[screenId];
  const screenCopy = deepClone(screen);
  injectButtonEvents(screenId, screenCopy); // –í—ã–∑–æ–≤ –∏–Ω—ä–µ–∫—Ü–∏–∏
  return screenCopy;
};
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –ø—É—Å—Ç–∞—è, —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- –°–æ–±—ã—Ç–∏—è —É–∂–µ –æ–ø–∏—Å–∞–Ω—ã –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö JSON
- 68 —Å—Ç—Ä–æ–∫ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞

#### ‚úÖ –°—Ç–∞–ª–æ (—É–ø—Ä–æ—â–µ–Ω–∏–µ):

```javascript
const getScreenPayload = (screenId) => {
  const screen = SCREEN_REGISTRY[screenId];
  if (!screen || typeof screen !== 'object') {
    throw new HttpError(500, `Unknown screen '${screenId}' in sandbox flow`);
  }
  // –°–æ–±—ã—Ç–∏—è —É–∂–µ –æ–ø–∏—Å–∞–Ω—ã –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö JSON, –∏–Ω—ä–µ–∫—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
  return deepClone(screen);
};
```

**–°–æ–±—ã—Ç–∏—è –≤ JSON (–ø—Ä–∏–º–µ—Ä –∏–∑ avitoDemo.json):**
```json
{
  "id": "button-increment",
  "type": "button",
  "properties": {
    "text": "+",
    "event": "incrementItem",
    "eventParams": {
      "itemId": "${cartItem.id}"
    }
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–¥–∞–ª–∏–ª–∏ 68 —Å—Ç—Ä–æ–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –°–æ–±—ã—Ç–∏—è —É–∂–µ –≤ JSON –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- ‚úÖ –£–ø—Ä–æ—Å—Ç–∏–ª–∏ getScreenPayload –¥–æ 5 —Å—Ç—Ä–æ–∫

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –£–¥–∞–ª—ë–Ω–Ω—ã–π –∫–æ–¥:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------|---------------|---------|
| EVENT_RULES | 18 | –í—ã–Ω–µ—Å–µ–Ω–æ –≤ JSON (–ø–æ–ª—è event/keepInputs) |
| buildDynamicPatch | 14 | –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞, –∑–∞–º–µ–Ω–µ–Ω–∞ –ø—Ä—è–º–æ–π –∏–Ω—ä–µ–∫—Ü–∏–µ–π |
| BUTTON_EVENT_INJECTIONS | 3 | –ü—É—Å—Ç–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| injectButtonEvents | 65 | –°–æ–±—ã—Ç–∏—è —É–∂–µ –≤ JSON –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö |
| –í—ã–∑–æ–≤—ã –∏ –∏–º–ø–æ—Ä—Ç—ã | -19 | –£–¥–∞–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ —É–±—Ä–∞–Ω–Ω—ã–π –∫–æ–¥ |
| **–ò–¢–û–ì–û** | **-81 —Å—Ç—Ä–æ–∫–∞** | **-9.3% –æ—Ç –æ–±—â–µ–≥–æ –æ–±—ä—ë–º–∞** |

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------------|------------|
| –ü–æ–∏—Å–∫ event –≤ EDGE_REGISTRY | +8 | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —Ä—ë–±–µ—Ä –ø–æ —Å–æ–±—ã—Ç–∏—é |
| –ò–Ω—ä–µ–∫—Ü–∏—è inputs –¥–ª—è ecommerceDashboard | +3 | –ü—Ä—è–º–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ inputs –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| **–ò–¢–û–ì–û** | **+11 —Å—Ç—Ä–æ–∫** | **–ó–∞–º–µ–Ω–∞ 81 —Å—Ç—Ä–æ–∫–∏ —Ö–∞—Ä–¥–∫–æ–¥–∞** |

### –ß–∏—Å—Ç—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- **-70 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –≤ server.js
- **+12 –ø–æ–ª–µ–π** –≤ JSON (event/keepInputs –≤ —Ä—ë–±—Ä–∞—Ö)
- **0 —Ö–∞—Ä–¥–∫–æ–¥-–∫–æ–Ω—Å—Ç–∞–Ω—Ç** –¥–ª—è —Å–æ–±—ã—Ç–∏–π

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å

**–î–æ:**
```javascript
// –ö–æ–¥ –¥–∏–∫—Ç—É–µ—Ç –ö–ê–ö–ò–ï —Å–æ–±—ã—Ç–∏—è –∏ –ö–ê–ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
if (event === 'incrementItem') {
  edge = findEdge('cart-main', 'edge-increment-item');
  keepInputs = true;
}
```

**–ü–æ—Å–ª–µ:**
```json
// JSON –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ß–¢–û –¥–µ–ª–∞—Ç—å, —Å–µ—Ä–≤–µ—Ä –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç
{
  "event": "incrementItem",
  "keepInputs": true,
  "target": "action-increment"
}
```

### 2. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è:**

**–î–æ:** –ü—Ä–∞–≤–∫–∞ 3 —Ñ–∞–π–ª–æ–≤
- ‚úèÔ∏è server.js (–¥–æ–±–∞–≤–∏—Ç—å –≤ EVENT_RULES)
- ‚úèÔ∏è avitoDemo.json (–¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—Ä–æ)
- ‚úèÔ∏è screen JSON (–¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É)

**–ü–æ—Å–ª–µ:** –ü—Ä–∞–≤–∫–∞ 2 —Ñ–∞–π–ª–æ–≤
- ‚úèÔ∏è avitoDemo.json (–¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—Ä–æ —Å event)
- ‚úèÔ∏è screen JSON (–¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É)

### 3. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å

**–î–æ:**
```javascript
// –û—Ç–¥–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞
const EVENT_RULES = PRESET_NAME === 'ecommerceDashboard' ? {...} : {...};
```

**–ü–æ—Å–ª–µ:**
```javascript
// –°–µ—Ä–≤–µ—Ä —á–∏—Ç–∞–µ—Ç –∏–∑ –ª—é–±–æ–≥–æ JSON
for (const [edgeId, edge] of EDGE_REGISTRY.entries()) {
  if (edge.event && edge.event.toLowerCase() === normalized) {
    return edge;
  }
}
```

### 4. –°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ JSON:**
```json
{
  "id": "edge-increment-item",
  "label": "–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
  "event": "incrementItem",
  "keepInputs": true,
  "summary": "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–∏",
  "target": "action-increment"
}
```

- `label` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `summary` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–ª–æ–≤–∞–º–∏
- `event` ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä —Å–æ–±—ã—Ç–∏—è
- `keepInputs` ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- `target` ‚Äî —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –≥—Ä–∞—Ñ–∞

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è "removeAll"

**1. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—Ä–æ –≤ avitoDemo.json:**
```json
{
  "id": "edge-remove-all",
  "label": "–£–¥–∞–ª–∏—Ç—å –≤—Å—ë",
  "event": "removeAll",
  "keepInputs": true,
  "target": "action-remove-all",
  "contextPatch": {
    "cart.pearStoreItems": [],
    "cart.technoStoreItems": [],
    "cart.totalPrice": 0,
    "cart.selectedCount": 0
  }
}
```

**2. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ screen JSON:**
```json
{
  "type": "button",
  "properties": {
    "text": "–£–¥–∞–ª–∏—Ç—å –≤—Å—ë",
    "event": "removeAll"
  }
}
```

**3. –ì–æ—Ç–æ–≤–æ!** –ö–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, —Å–æ–±—ã—Ç–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è keepInputs

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü–æ—Å–ª–µ clearAll –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å inputs.

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å –æ–¥–Ω–æ –ø–æ–ª–µ –≤ JSON:
```json
{
  "id": "edge-clear-all",
  "event": "clearAll",
  "keepInputs": false  // –±—ã–ª–æ: true
}
```

–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ —Å–µ—Ä–≤–µ—Ä–∞!

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç—ã avitoDemo:

```bash
# –¢–µ—Å—Ç increment
curl 'http://localhost:5050/api/action?event=incrementItem&itemId=item-1'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"qty":2,"total":125960,"count":4} ‚úÖ

# –¢–µ—Å—Ç decrement
curl 'http://localhost:5050/api/action?event=decrementItem&itemId=item-1'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"qty":1,"total":120970,"count":3} ‚úÖ
```

### –¢–µ—Å—Ç—ã ecommerceDashboard:

```bash
# –¢–µ—Å—Ç –≤–∞–ª–∏–¥–Ω–æ–≥–æ email
curl 'http://localhost:5050/api/action?event=checkEmail&email=test@example.com'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"success","email":"test@example.com"} ‚úÖ

# –¢–µ—Å—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ email
curl 'http://localhost:5050/api/action?event=checkEmail&email=invalid'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"error","message":"Email —É–∫–∞–∑–∞–Ω –≤ –Ω–µ–≤–µ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"} ‚úÖ
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

| –¢–µ—Å—Ç | –°—Ç–∞—Ç—É—Å |
|------|--------|
| avitoDemo: increment | ‚úÖ PASS |
| avitoDemo: decrement | ‚úÖ PASS |
| ecommerceDashboard: –≤–∞–ª–∏–¥–Ω—ã–π email | ‚úÖ PASS |
| ecommerceDashboard: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email | ‚úÖ PASS |
| ecommerceDashboard: –ø—É—Å—Ç–æ–π email | ‚úÖ PASS |

---

## üéì –í—ã–≤–æ–¥—ã

### –ß—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:

1. ‚úÖ **–£–¥–∞–ª–µ–Ω–æ 81 —Å—Ç—Ä–æ–∫–∞** —Ö–∞—Ä–¥–∫–æ–¥–∞ (-9.3%)
2. ‚úÖ **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–µ–Ω–∞** —Å ~60% –¥–æ ~95%
3. ‚úÖ **–°–µ—Ä–≤–µ—Ä —Å—Ç–∞–ª —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º** ‚Äî –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤
4. ‚úÖ **–£–ø—Ä–æ—â–µ–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π** ‚Äî —Ç–æ–ª—å–∫–æ JSON, –±–µ–∑ –ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞
5. ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥–æ–≤–∞–ª–∏:

- **JSON –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ß–¢–û** –¥–µ–ª–∞—Ç—å (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ)
- **–ö–æ–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –ö–ê–ö** –¥–µ–ª–∞—Ç—å (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ)
- **–õ–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ** ‚Äî —Ä—ë–±—Ä–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–æ–±—ã—Ç–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞ ‚Äî –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤** ‚Äî –ø—Ä–æ—Å—Ç–æ—Ç–∞ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **Remote fetch –ª–æ–≥–∏–∫–∞** ‚Üí Action-—É–∑–ª—ã —Å —Ç–∏–ø–æ–º `fetch-external`
2. **–£—Å–ª–æ–≤–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** ‚Üí –ë–æ–ª–µ–µ –≥–∏–±–∫–∏–µ expression-–¥–≤–∏–∂–∫–∏
3. **–ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã** ‚Üí –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ UI-–ø–æ–≤–µ–¥–µ–Ω–∏—è
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π** ‚Üí –¢—Ä–µ–∫–∏–Ω–≥ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

---

**–ê–≤—Ç–æ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** GitHub Copilot  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 30 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
