# –°–≤–æ–¥–∫–∞: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤

## ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –§—É–Ω–∫—Ü–∏–∏ –≤ `src/utils/avitoDemoConverter.js`

–î–æ–±–∞–≤–ª–µ–Ω–æ **8 –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤:

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **`updateItemQuantity(cartItems, itemId, delta, options)`**
   - –ò–∑–º–µ–Ω—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ min/max –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ quantity = 0
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–µ—Ä–∞—Ü–∏–∏

2. **`setItemQuantity(cartItems, itemId, quantity, options)`**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç previous/new quantity

3. **`calculateCartTotals(cartItems)`**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤—ã—Ö —Å—É–º–º
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (isSelected: true)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: selectedCount, totalPrice, totalDiscount, itemsCount

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

4. **`applyQuantityChangeToContext(context, itemId, delta, options)`**
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫ –ø–æ–ª–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—ã
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—É—Ç–µ–π (cartPath)

5. **`createQuantityChangeContextPatch(itemId, delta, options)`**
   - –°–æ–∑–¥–∞—ë—Ç contextPatch –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ workflow
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ edges –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

6. **`createQuantityActionNode(config)`**
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç action-—É–∑–µ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π (itemIdVariable, deltaVariable, limits)
   - –ì–æ—Ç–æ–≤ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –≤ React Flow –≥—Ä–∞—Ñ

#### –í–∞–ª–∏–¥–∞—Ü–∏—è

7. **`validateQuantityOperation(operation)`**
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å min/max

### 2. –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test-quantity-management.js`

**13 –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ/—É–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è min/max
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ quantity = 0
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –ü–µ—Ä–µ—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤—ã—Ö —Å—É–º–º
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏/–Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ contextPatch
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ action-—É–∑–ª–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–∑–∏–Ω–æ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã ‚úÖ

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `docs/QUANTITY_MANAGEMENT.md`

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- API Reference –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- 6 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- Best practices
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è

```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü
updateItemQuantity(items, 'item-1', +1, { 
  min: 0,    // –ú–∏–Ω–∏–º—É–º
  max: 10    // –ú–∞–∫—Å–∏–º—É–º
});
// ‚Üí –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç, –≤–µ—Ä–Ω—ë—Ç { success: false, message: "..." }
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```javascript
// –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ quantity = 0
updateItemQuantity(items, 'item-1', -1, { 
  removeOnZero: true 
});
// ‚Üí { success: true, removed: true, items: [...] }
```

### –ü–µ—Ä–µ—Å—á—ë—Ç —Å—É–º–º

```javascript
const totals = calculateCartTotals(cartItems);
// ‚Üí {
//   selectedCount: 5,      // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
//   totalPrice: 120000,    // –°—É–º–º–∞
//   totalDiscount: 10000,  // –°–∫–∏–¥–∫–∞
//   itemsCount: 3          // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π
// }
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

```javascript
// –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫ –ø–æ–ª–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
const updated = applyQuantityChangeToContext(
  context,
  'item-1',
  +2
);
// ‚Üí –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏
```

### –°–æ–∑–¥–∞–Ω–∏–µ action-—É–∑–ª–æ–≤

```javascript
const actionNode = createQuantityActionNode({
  name: 'IncrementQuantity',
  deltaVariable: 'delta',
  maxQuantity: 99
});
// ‚Üí –ì–æ—Ç–æ–≤—ã–π —É–∑–µ–ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≥—Ä–∞—Ñ workflow
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~350
- **–§—É–Ω–∫—Ü–∏–π:** 8
- **–¢–µ—Å—Ç–æ–≤:** 13 ‚úÖ
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 1 —Ñ–∞–π–ª (300+ —Å—Ç—Ä–æ–∫)

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í UI –∫–æ—Ä–∑–∏–Ω—ã

```javascript
<button onClick={() => {
  const result = updateItemQuantity(cart, item.id, +1);
  if (result.success) {
    setCart(result.items);
    setTotals(calculateCartTotals(result.items));
  }
}}>+</button>
```

### –í workflow action-—É–∑–ª–µ

```json
{
  "type": "action",
  "data": {
    "actionType": "modify-cart-item",
    "config": {
      "operation": "update_quantity",
      "itemIdVariable": "itemId",
      "deltaVariable": "delta",
      "max": 99
    }
  }
}
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

```javascript
// server/js/server.js
const result = updateItemQuantity(
  session.cart.items,
  itemId,
  delta,
  { removeOnZero: true }
);

if (result.success) {
  session.cart.items = result.items;
  const totals = calculateCartTotals(result.items);
  session.cart = { ...session.cart, ...totals };
}
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### VirtualContext

```javascript
// –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–¥—å—é—Å–µ—Ä
case 'UPDATE_ITEM_QUANTITY':
  return {
    ...state,
    context: applyQuantityChangeToContext(
      state.context,
      action.payload.itemId,
      action.payload.delta
    )
  };
```

### SandboxScreenRenderer

```javascript
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
const handleQuantityChange = (itemId, delta) => {
  const updated = applyQuantityChangeToContext(
    context,
    itemId,
    delta,
    { removeOnZero: true }
  );
  setContext(updated);
};
```

### ApiSandboxRunner

```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
const response = await fetch('/api/action', {
  method: 'POST',
  body: JSON.stringify({
    action: 'update_quantity',
    itemId: 'item-1',
    delta: +1
  })
});
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ

- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è min/max —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ quantity = 0 —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–µ—Ä–µ—Å—á—ë—Ç —Å—É–º–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- ‚úÖ –£—á—ë—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö/–Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ action-—É–∑–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–§—É–Ω–∫—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤:
- ‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ Action-—É–∑–ª—ã workflow
- ‚úÖ Technical states
- ‚úÖ –°–µ—Ä–≤–µ—Ä–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (Node.js/Python)
- ‚úÖ SandboxScreenRenderer
- ‚úÖ VirtualContext

## üîó –§–∞–π–ª—ã

- **–ö–æ–¥:** `src/utils/avitoDemoConverter.js` (—Å—Ç—Ä–æ–∫–∏ 797-1147)
- **–¢–µ—Å—Ç—ã:** `test-quantity-management.js`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/QUANTITY_MANAGEMENT.md`

---

**–î–∞—Ç–∞:** 2 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
