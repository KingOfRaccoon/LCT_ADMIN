<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="640" viewBox="0 0 1000 640">
  <style>
    .actor { font: 14px/1.2 'Helvetica Neue', Arial, sans-serif; fill: #0f172a; font-weight: 600; }
    .note { font: 12px/1.2 'Helvetica Neue', Arial, sans-serif; fill: #0f172a; }
    .box { fill: #f8fafc; stroke: #e6eef8; stroke-width: 1; rx: 8; }
    .line { stroke: #94a3b8; stroke-width: 2; marker-end: url(#arrow); }
    .lifeline { stroke: #cbd5e1; stroke-dasharray: 4 4; stroke-width: 1.5; }
    .log { font: 12px 'Courier New', monospace; fill: #0f172a; }
    .title { font: 16px/1.2 'Helvetica Neue', Arial, sans-serif; fill: #0f172a; font-weight: 700; }
  </style>

  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#94a3b8" />
    </marker>
  </defs>

  <rect x="16" y="12" width="968" height="40" rx="6" class="box" />
  <text x="36" y="38" class="title">Диаграмма последовательностей: клик на ребро edge-submit-success</text>

  <!-- Actors -->
  <g transform="translate(40,100)">
    <text x="0" y="0" class="actor">Пользователь</text>
    <rect x="0" y="8" width="120" height="30" class="box" />
  </g>

  <g transform="translate(200,100)">
    <text x="0" y="0" class="actor">SandboxPage</text>
    <rect x="0" y="8" width="130" height="30" class="box" />
  </g>

  <g transform="translate(380,100)">
    <text x="0" y="0" class="actor">applyContextPatch</text>
    <rect x="0" y="8" width="170" height="30" class="box" />
  </g>

  <g transform="translate(580,100)">
    <text x="0" y="0" class="actor">setContextValue</text>
    <rect x="0" y="8" width="150" height="30" class="box" />
  </g>

  <g transform="translate(760,100)">
    <text x="0" y="0" class="actor">Рендерер</text>
    <rect x="0" y="8" width="120" height="30" class="box" />
  </g>

  <!-- Lifelines -->
  <line x1="100" y1="160" x2="100" y2="540" class="lifeline" />
  <line x1="265" y1="160" x2="265" y2="540" class="lifeline" />
  <line x1="450" y1="160" x2="450" y2="540" class="lifeline" />
  <line x1="655" y1="160" x2="655" y2="540" class="lifeline" />
  <line x1="820" y1="160" x2="820" y2="540" class="lifeline" />

  <!-- Arrows -->
  <line x1="100" y1="190" x2="265" y2="190" class="line" />
  <text x="140" y="182" class="note">click edge-submit-success</text>

  <line x1="265" y1="220" x2="450" y2="220" class="line" />
  <text x="320" y="212" class="note">applyContextPatch(context, patch)</text>

  <line x1="450" y1="250" x2="655" y2="250" class="line" />
  <text x="500" y="242" class="note">setContextValue(path, value)</text>

  <line x1="655" y1="280" x2="450" y2="280" class="line" marker-end="url(#arrow)" />
  <text x="520" y="272" class="note">write confirmed</text>

  <line x1="450" y1="310" x2="265" y2="310" class="line" />
  <text x="320" y="302" class="note">return newContext</text>

  <line x1="265" y1="340" x2="820" y2="340" class="line" />
  <text x="520" y="332" class="note">re-render with newContext</text>

  <line x1="820" y1="370" x2="655" y2="370" class="line" />
  <text x="700" y="362" class="note">resolveBindingValue('${data.order.totalFormatted}')</text>

  <line x1="655" y1="400" x2="820" y2="400" class="line" marker-end="url(#arrow)" />
  <text x="700" y="392" class="note">'12 990 ₽' (resolved)</text>

  <line x1="820" y1="430" x2="655" y2="430" class="line" />
  <text x="700" y="422" class="note">resolveBindingValue('${data.cart.items}')</text>

  <line x1="655" y1="460" x2="820" y2="460" class="line" marker-end="url(#arrow)" />
  <text x="700" y="452" class="note">['Тариф...', 'Сопровождение...', '...']</text>

  <!-- Logs box -->
  <rect x="40" y="520" width="920" height="100" rx="8" class="box" />
  <text x="60" y="545" class="note">Ожидаемые логи (пример):</text>
  <text x="60" y="565" class="log">[sandbox] applyContextPatch start { patch: {...} }</text>
  <text x="60" y="585" class="log">[sandbox] setContextValue write { path: 'data.order.status', value: 'paid' }</text>
  <text x="60" y="605" class="log">[sandbox] setContextValue write { path: 'data.order.totalFormatted', value: '12 990 ₽' }</text>
  <text x="60" y="625" class="log">[sandbox] applyContextPatch end { keys: ['ui','data', ...] }</text>

</svg>